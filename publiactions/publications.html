<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Publications | Arghavan Alisoltani</title>
  <meta name="description" content="Publications categorized by topic, searchable, and continuously updated." />

  <style>
    :root{
      --bg:#0b1020;
      --panel:#111a33;
      --panel2:#0f1730;
      --text:#e9eefc;
      --muted:#aab6e8;
      --accent:#7aa2ff;
      --accent2:#70ffd1;
      --border:rgba(255,255,255,.10);
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius:16px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:var(--sans);
      background:
        radial-gradient(1200px 600px at 20% 0%, rgba(122,162,255,.20), transparent 60%),
        radial-gradient(900px 500px at 90% 10%, rgba(112,255,209,.12), transparent 55%),
        var(--bg);
      color:var(--text);
    }
    a{color:var(--accent); text-decoration:none}
    a:hover{text-decoration:underline}
    header{padding:28px 18px 18px; max-width:1280px; margin:0 auto;}
    .hero{
      background: linear-gradient(135deg, rgba(122,162,255,.18), rgba(17,26,51,.0));
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:18px 18px;
    }
    h1{margin:0 0 8px; font-size: clamp(22px, 4vw, 36px); letter-spacing:.2px;}
    .subtitle{margin:0 0 12px; color:var(--muted); line-height:1.6; font-size:15px; max-width:1150px;}
    .kicker{
      color:var(--accent2);
      font-weight:900;
      letter-spacing:.35px;
      text-transform:uppercase;
      font-size:12px;
      margin-top:12px;
    }

    main{
      max-width:1280px;
      margin:0 auto;
      padding: 0 18px 48px;
      display:grid;
      grid-template-columns: 360px 1fr;
      gap:14px;
    }
    nav{
      position:sticky;
      top:14px;
      align-self:start;
      height: calc(100vh - 28px);
      overflow:auto;
      border:1px solid var(--border);
      border-radius:var(--radius);
      background: rgba(17,26,51,.55);
      backdrop-filter: blur(10px);
      box-shadow:var(--shadow);
      padding:12px;
    }
    nav h2{
      font-size:13px;
      margin:6px 8px 10px;
      color:var(--muted);
      letter-spacing:.4px;
      text-transform:uppercase;
    }
    .panel{
      border:1px solid var(--border);
      border-radius:14px;
      background: rgba(0,0,0,.18);
      padding:12px;
      margin:10px 6px;
    }
    .field{margin-top:10px}
    .label{font-size:12px; color:var(--muted); font-weight:900; letter-spacing:.25px; text-transform:uppercase}
    input[type="search"], select{
      width:100%;
      margin-top:6px;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.04);
      color:var(--text);
      outline:none;
    }
    option{color:#111}
    .btnrow{display:flex; gap:10px; flex-wrap:wrap; margin-top:10px}
    .btn{
      padding:10px 12px;
      border-radius:12px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.06);
      color:var(--text);
      cursor:pointer;
      font-weight:800;
      white-space:nowrap;
      flex:1;
      text-align:center;
      user-select:none;
    }
    .btn:hover{background: rgba(255,255,255,.10)}
    .btn.small{padding:8px 10px; font-size:12px; flex:0}
    .hint{color:var(--muted); font-size:13px; line-height:1.55; margin-top:10px}

    .content{display:flex; flex-direction:column; gap:12px;}
    .section{
      border:1px solid var(--border);
      border-radius:var(--radius);
      background: rgba(17,26,51,.45);
      backdrop-filter: blur(10px);
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .section-header{
      padding:14px 16px;
      border-bottom:1px solid var(--border);
      background: rgba(15,23,48,.55);
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .section-title{margin:0; font-size:16px; line-height:1.35}
    .tag{
      font-size:12px;
      color:var(--muted);
      border:1px solid var(--border);
      padding:4px 10px;
      border-radius:999px;
      background: rgba(255,255,255,.04);
      white-space:nowrap;
    }
    .section-body{padding:14px 16px 16px}

    .paper{
      border:1px solid var(--border);
      border-radius:14px;
      background: rgba(0,0,0,.20);
      padding:12px 12px;
      margin-top:10px;
    }
    .paper-top{
      display:flex;
      gap:10px;
      align-items:flex-start;
      justify-content:space-between;
      flex-wrap:wrap;
    }
    .num{
      font-family:var(--mono);
      font-weight:900;
      color:var(--accent2);
      background: rgba(112,255,209,.08);
      border:1px solid rgba(112,255,209,.25);
      padding:3px 8px;
      border-radius:999px;
      font-size:12px;
      white-space:nowrap;
    }
    .title{
      margin:0;
      font-size:14.5px;
      line-height:1.45;
      font-weight:900;
      flex:1;
      min-width:240px;
    }
    .meta{color:var(--muted); margin-top:6px; font-size:13.5px; line-height:1.5}
    .pillrow{display:flex; gap:8px; flex-wrap:wrap; margin-top:10px}
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.05);
      color:var(--text);
      font-weight:900;
      font-size:12.5px;
    }
    .pill:hover{background: rgba(255,255,255,.10); text-decoration:none}
    .muted{color:var(--muted)}

    details{
      border:1px solid var(--border);
      background: rgba(255,255,255,.03);
      border-radius:14px;
      padding:10px 12px;
      margin:10px 0 0;
    }
    summary{
      cursor:pointer;
      font-weight:900;
      color:var(--text);
      list-style:none;
      user-select:none;
    }
    summary::-webkit-details-marker{display:none}
    summary:before{content:"▸"; margin-right:8px; color:var(--muted)}
    details[open] summary:before{content:"▾"}

    .mono{font-family:var(--mono)}
    code.inline{font-family:var(--mono); font-size: 0.95em; background: rgba(0,0,0,.25); border:1px solid var(--border); padding:2px 6px; border-radius:10px;}

    @media (max-width: 1100px){
      main{grid-template-columns:1fr}
      nav{position:relative; height:auto}
    }
  </style>
</head>

<body>
<header>
  <div class="hero">
    <h1>Publications</h1>
    <p class="subtitle">
      Numbered and categorized by topic (auto-generated from the publication list below).
      To add more papers later, append to the <code class="inline">publications</code> array (near the bottom) — everything re-renders automatically.
    </p>

    <div class="kicker">Recommended folder structure (GitHub Pages)</div>
    <p class="subtitle">
      Put PDFs in <code class="inline">/papers/</code> and link them with <code class="inline">papers/your_file.pdf</code>.
      External links (DOI, journal page, PubMed, arXiv) can be used too.
    </p>
  </div>
</header>

<main>
  <nav>
    <h2>Filters</h2>

    <div class="panel">
      <div class="field">
        <div class="label">Search</div>
        <input id="q" type="search" placeholder="Search title, authors, venue, keywords…" />
      </div>

      <div class="field">
        <div class="label">Category</div>
        <select id="category"></select>
      </div>

      <div class="field">
        <div class="label">Year</div>
        <select id="year"></select>
      </div>

      <div class="field">
        <div class="label">Sort</div>
        <select id="sort">
          <option value="year_desc">Year (new → old)</option>
          <option value="year_asc">Year (old → new)</option>
          <option value="title_asc">Title (A → Z)</option>
          <option value="title_desc">Title (Z → A)</option>
        </select>
      </div>

      <div class="btnrow">
        <div class="btn" id="reset">Reset</div>
        <div class="btn" id="copyTemplate">Copy “new paper” template</div>
      </div>

      <div class="hint">
        <b>Tip:</b> If you change category names, keep them consistent across entries (this drives the topic sections).
      </div>

      <details>
        <summary>How to add a new paper (2 minutes)</summary>
        <ol class="muted">
          <li>Add the PDF to <code class="inline">/papers/</code> (optional).</li>
          <li>Append a new object to the <code class="inline">publications</code> array.</li>
          <li>Set <code class="inline">topics</code> to 1–3 categories (e.g., “Viral Genomics”).</li>
          <li>Refresh the page — numbering and sections update automatically.</li>
        </ol>
      </details>
    </div>

    <h2>Quick links</h2>
    <div class="panel" id="navTopics"></div>

    <h2>Sections</h2>
    <div class="panel">
      <a class="pill" href="#under-development">Unpublished / Under development</a>
      <a class="pill" href="#all-publications">All publications</a>
    </div>
  </nav>

  <section class="content">
    <!-- Under development -->
    <article class="section" id="under-development">
      <div class="section-header">
        <h2 class="section-title">Unpublished / Under development</h2>
        <span class="tag">Projects & tools</span>
      </div>
      <div class="section-body">
        <div class="paper">
          <div class="paper-top">
            <span class="num">UD-01</span>
            <p class="title">MetaProt — metaproteomics platform</p>
          </div>
          <div class="pillrow">
            <a class="pill" target="_blank" rel="noopener" href="https://metaprot.org/">Website</a>
          </div>
        </div>

        <div class="paper">
          <div class="paper-top">
            <span class="num">UD-02</span>
            <p class="title">BacterialVar — bacterial variant analysis platform</p>
          </div>
          <div class="pillrow">
            <a class="pill" target="_blank" rel="noopener" href="https://bacterialvar.org">Website</a>
          </div>
        </div>

        <details>
          <summary>Add more “under development” items</summary>
          <p class="muted">
            You can either (1) keep adding cards here manually, or (2) create a separate <code class="inline">projects</code> array
            like the publications list and render it the same way.
          </p>
        </details>
      </div>
    </article>

    <!-- Publications render target -->
    <article class="section" id="all-publications">
      <div class="section-header">
        <h2 class="section-title">All publications (auto-numbered)</h2>
        <span class="tag" id="countTag">0 items</span>
      </div>
      <div class="section-body">
        <div id="pubRoot"></div>
      </div>
    </article>
  </section>
</main>

<script>
/**
 * ===========================
 * 1) EDIT YOUR LIST HERE
 * ===========================
 * - Put PDFs in /papers/ and link via: "papers/your_file.pdf"
 * - If you don’t have a PDF locally, use DOI/journal/PubMed links.
 * - topics controls category sections.
 */
const publications = [
  // --- Cancer / immunology / transcriptomics ---
  {
    year: 2023,
    title: "Gender differences in smoking-induced changes in the tumor immune microenvironment",
    authors: "Arghavan Alisoltani; Xinru Qiu; Lukasz Jaroszewski; Mayya Sedova; Mallika Iyer; Adam Godzik",
    venue: "Archives of Biochemistry and Biophysics",
    type: "Journal Article",
    topics: ["Cancer Genomics & Immunology"],
    keywords: ["TCGA", "immune subtypes", "bulk RNA-seq", "single-cell RNA-seq", "smoking"],
    links: [
      { label: "PDF (local)", href: "papers/Archives_Biochem_Biophys_2023_smoking_gender_TME.pdf" }
    ]
  },
  {
    year: 2014,
    title: "Prediction of Potential Cancer-Risk Regions Based on Transcriptome Data: Towards a Comprehensive View",
    authors: "Arghavan Alisoltani; Hossein Fallahi; Mahdi Ebrahimi; Mansour Ebrahimi; Esmaeil Ebrahimie",
    venue: "PLOS ONE",
    type: "Journal Article",
    topics: ["Cancer Genomics & Immunology", "Computational Genomics / Methods"],
    keywords: ["microarray", "risk regions", "mRNA", "miRNA", "networks"],
    links: [
      { label: "PDF (local)", href: "papers/PLOS_ONE_2014_cancer_risk_regions.pdf" }
    ]
  },
  {
    year: 2015,
    title: "RNA-Seq SSRs and small RNA-Seq SSRs: New approaches in cancer biomarker discovery",
    authors: "Arghavan Alisoltani; Hossein Fallahi; Behrouz Shiran; Anousheh Alisoltani; Esmaeil Ebrahimie",
    venue: "Gene",
    type: "Journal Article",
    topics: ["Cancer Genomics & Immunology", "Computational Genomics / Methods"],
    keywords: ["RNA-seq", "small RNA-seq", "SSRs", "biomarkers", "pancreatic cancer"],
    links: [
      { label: "PDF (local)", href: "papers/Gene_2015_RNAseq_SSR_biomarkers.pdf" }
    ]
  },
  {
    year: 2023,
    title: "Systems analysis reveals differential expression of endocervical genes in African women randomized to DMPA-IM, LNG implant or cu-IUD",
    authors: "Prachi Mehrotra Gupta; Christina Balle; ...; Arghavan Alisoltani; ...; Steven E. Bosinger",
    venue: "Clinical Immunology",
    type: "Journal Article",
    topics: ["Cancer Genomics & Immunology", "Human Immunology & Transcriptomics"],
    keywords: ["FGT", "RNA-seq", "contraception", "mucosa", "ECHO trial"],
    links: [
      { label: "PDF (local)", href: "papers/Clinical_Immunology_2023_ECHO_endocervix_transcriptome.pdf" }
    ]
  },

  // --- Viral genomics / structural bioinformatics ---
  {
    year: 2020,
    title: "Coronavirus3D: 3D structural visualization of COVID-19 genomic divergence",
    authors: "Mayya Sedova; Lukasz Jaroszewski; Arghavan Alisoltani; Adam Godzik",
    venue: "Bioinformatics",
    type: "Application Note",
    topics: ["Viral Genomics & Structural Bioinformatics", "Software / Web Tools"],
    keywords: ["SARS-CoV-2", "3D structures", "mutations", "visualization"],
    links: [
      { label: "PDF (local)", href: "papers/Bioinformatics_2020_Coronavirus3D.pdf" },
      { label: "Website", href: "https://coronavirus3d.org" }
    ]
  },
  {
    year: 2022,
    title: "Increased Frequency of Indels in Hypervariable Regions of SARS-CoV-2 Proteins—A Possible Signature of Adaptive Selection",
    authors: "Arghavan Alisoltani; Lukasz Jaroszewski; Mallika Iyer; Arash Iranzadeh; Adam Godzik",
    venue: "Frontiers in Genetics",
    type: "Journal Article",
    topics: ["Viral Genomics & Structural Bioinformatics", "Computational Genomics / Methods"],
    keywords: ["indels", "variants of concern", "hypervariable regions", "immune escape"],
    links: [
      { label: "PDF (local)", href: "papers/Frontiers_Genetics_2022_SARSCoV2_indels_HVR.pdf" }
    ]
  },
  {
    year: 2023,
    title: "US National Institutes of Health Prioritization of SARS-CoV-2 Variants",
    authors: "Sam Turner; Arghavan Alisoltani; ...; Derek J. Smith",
    venue: "Emerging Infectious Diseases (CDC)",
    type: "Online Report",
    topics: ["Viral Genomics & Structural Bioinformatics", "Public Health Genomics"],
    keywords: ["variant prioritization", "surveillance", "phenotypic testing", "NIH SAVE"],
    links: [
      { label: "PDF (local)", href: "papers/EID_2023_NIH_prioritization_variants.pdf" }
    ]
  },

  // --- Microbial metagenomics / environment ---
  {
    year: 2018,
    title: "Metagenomic analysis of the bacterial communities and their functional profiles in water and sediments of the Apies River, South Africa, as a function of land use",
    authors: "Akebe Luther King Abia; Arghavan Alisoltani; Jitendra Keshri; Eunice Ubomba-Jaswa",
    venue: "Science of the Total Environment",
    type: "Journal Article",
    topics: ["Microbial Genomics & Metagenomics"],
    keywords: ["16S", "river", "sediment", "land use", "PICRUSt"],
    links: [
      { label: "PDF (local)", href: "papers/STOTEN_2018_Apies_River_metagenomics.pdf" }
    ]
  },
  {
    year: 2019,
    title: "Microbial life beyond the grave: 16S rRNA gene-based metagenomic analysis of bacteria diversity and their functional profiles in cemetery environments",
    authors: "Akebe Luther King Abia; Arghavan Alisoltani; Eunice Ubomba-Jaswa; Matthys Alois Dippenaar",
    venue: "Science of the Total Environment",
    type: "Journal Article",
    topics: ["Microbial Genomics & Metagenomics"],
    keywords: ["16S", "cemetery soil", "functional profiles", "groundwater"],
    links: [
      { label: "PDF (local)", href: "papers/STOTEN_2019_cemetery_metagenomics.pdf" }
    ]
  },
  {
    year: 2020,
    title: "Bacterial diversity and functional profile of microbial populations on surfaces in public hospital environments in South Africa: A high throughput metagenomic analysis",
    authors: "Christiana Omowunmi Shobo; Arghavan Alisoltani; Akebe Luther King Abia; ...; Linda Antoinette Bester",
    venue: "Science of the Total Environment",
    type: "Journal Article",
    topics: ["Microbial Genomics & Metagenomics", "Hospital & One Health Microbiology"],
    keywords: ["hospital surfaces", "16S", "OTUs", "functional profiling", "antibiotic resistance"],
    links: [
      { label: "PDF (local)", href: "papers/STOTEN_2020_hospital_surfaces_metagenomics.pdf" }
    ]
  },
  {
    year: 2019,
    title: "Shared Microbiome in Different Ecosystems: A Meta-Omics Perspective",
    authors: "Arghavan Alisoltani; Akebe Luther King Abia; Linda Bester",
    venue: "Book Chapter (Microbial Genomics in Sustainable Agroecosystems)",
    type: "Book Chapter",
    topics: ["Microbial Genomics & Metagenomics", "Review / Perspective"],
    keywords: ["meta-omics", "MGnify", "core microbiome", "ecosystems"],
    links: [
      { label: "PDF (local)", href: "papers/Springer_2019_Shared_microbiome_metaomics_chapter.pdf" }
    ]
  },

  // --- Bacterial pathogenesis / AMR ---
  {
    year: 2023,
    title: "Genomics of Aminoglycoside Resistance in Pseudomonas aeruginosa Bloodstream Infections at a United States Academic Hospital",
    authors: "Giancarlo Atassi; Rachel Medernach; ...; Arghavan Alisoltani; ...; Alan R. Hauser",
    venue: "Microbiology Spectrum",
    type: "Journal Article",
    topics: ["Bacterial Pathogenesis & AMR"],
    keywords: ["Pseudomonas aeruginosa", "aminoglycosides", "AME genes", "mexZ", "armZ"],
    links: [
      { label: "PDF (local)", href: "papers/Spectrum_2023_Pa_aminoglycoside_resistance.pdf" }
    ]
  },
  {
    year: 2023,
    title: "Genome-wide screens reveal shared and strain-specific genes that facilitate enteric colonization by Klebsiella pneumoniae",
    authors: "Bettina H. Cheung; Arghavan Alisoltani; ...; Alan R. Hauser",
    venue: "mBio",
    type: "Journal Article",
    topics: ["Bacterial Pathogenesis & AMR"],
    keywords: ["Klebsiella pneumoniae", "Tn-Seq", "colonization", "acrA", "bile tolerance"],
    links: [
      { label: "PDF (local)", href: "papers/mBio_2023_Kp_GI_colonization_TnSeq.pdf" }
    ]
  },
  {
    year: 2025,
    title: "Cytotoxicity and Virulence Attributes of Pseudomonas Aeruginosa Isolates From Patients With Necrotizing Pneumonia (Abstract)",
    authors: "T. C. Bolig; ...; A. Alisoltanidehkordi; ...; A. R. Hauser",
    venue: "American Journal of Respiratory and Critical Care Medicine (Abstracts Supplement)",
    type: "Conference Abstract",
    topics: ["Bacterial Pathogenesis & AMR", "Conference / Abstracts"],
    keywords: ["necrotizing pneumonia", "exoU", "cytotoxicity", "virulence"],
    links: [
      { label: "PDF (local)", href: "papers/AJRCCM_2025_Abstract_A4515_PA_necrotizing_pneumonia.pdf" }
    ]
  },

  // --- Plant genomics / abiotic stress ---
  {
    year: 2014,
    title: "De Novo Transcriptome Assembly and Comparative Analysis of Differentially Expressed Genes in Prunus dulcis Mill. in Response to Freezing Stress",
    authors: "Sadegh Mousavi; Arghavan Alisoltani; Behrouz Shiran; Hossein Fallahi; Esmaeil Ebrahimie; Ali Imani; Saadollah Houshmand",
    venue: "PLOS ONE",
    type: "Journal Article",
    topics: ["Plant Genomics & Abiotic Stress"],
    keywords: ["almond", "RNA-seq", "freezing stress", "DE genes", "Rosaceae"],
    links: [
      { label: "PDF (local)", href: "papers/PLOS_ONE_2014_almond_freezing_transcriptome.pdf" }
    ]
  },
  {
    year: 2016,
    title: "Parallel consideration of SSRs and differentially expressed genes under abiotic stress for targeted development of functional markers in almond and related Prunus species",
    authors: "Arghavan Alisoltani; Shekoufeh Ebrahimi; Sahar Azarian; Mahsa Hematyar; Behrouz Shiran; ...",
    venue: "Scientia Horticulturae",
    type: "Journal Article",
    topics: ["Plant Genomics & Abiotic Stress", "Computational Genomics / Methods"],
    keywords: ["RNA-Seq SSR", "functional markers", "frost stress", "Prunus"],
    links: [
      { label: "PDF (local)", href: "papers/ScientiaHort_2016_RNASeqSSR_almond_markers.pdf" }
    ]
  },
  {
    year: 2013,
    title: "Genetic diversity among and within Iranian and non-Iranian barley genotypes using SSR and storage proteins markers",
    authors: "Shahab Hajmansoor; Mohamad Reza Bihamta; Arghavan Alisoltani",
    venue: "Biochemical Systematics and Ecology",
    type: "Journal Article",
    topics: ["Plant Genomics & Abiotic Stress"],
    keywords: ["barley", "SSR", "hordeins", "drought", "MAS"],
    links: [
      { label: "PDF (local)", href: "papers/BiochemSysEcol_2013_barley_SSR_hordeins.pdf" }
    ]
  },
  {
    year: 2019,
    title: "Molecular Responses to Cold Stress in Temperate Fruit Crops with Focus on Rosaceae Family (Chapter 7)",
    authors: "Arghavan Alisoltani; Marziyeh Karimi; Rudabeh Ravash; Hossein Fallahi; Behrouz Shiran",
    venue: "Book Chapter (Genomics Assisted Breeding of Crops for Abiotic Stress Tolerance, Vol. II)",
    type: "Book Chapter",
    topics: ["Plant Genomics & Abiotic Stress", "Review / Perspective"],
    keywords: ["cold stress", "Rosaceae", "NGS", "signal transduction"],
    links: [
      { label: "PDF (local)", href: "papers/Springer_2019_Rosaceae_cold_stress_chapter.pdf" }
    ]
  }
];

/**
 * ===========================
 * 2) RENDERING LOGIC
 * ===========================
 */
const els = {
  q: document.getElementById("q"),
  category: document.getElementById("category"),
  year: document.getElementById("year"),
  sort: document.getElementById("sort"),
  reset: document.getElementById("reset"),
  copyTemplate: document.getElementById("copyTemplate"),
  root: document.getElementById("pubRoot"),
  countTag: document.getElementById("countTag"),
  navTopics: document.getElementById("navTopics"),
};

function uniq(arr){ return Array.from(new Set(arr)); }
function norm(s){ return (s || "").toString().toLowerCase(); }

function buildFilters(){
  const allTopics = uniq(publications.flatMap(p => p.topics || [])).sort((a,b)=>a.localeCompare(b));
  const allYears = uniq(publications.map(p => p.year).filter(Boolean)).sort((a,b)=>b-a);

  // Category options
  els.category.innerHTML = "";
  const optAll = document.createElement("option");
  optAll.value = "__all__";
  optAll.textContent = "All topics";
  els.category.appendChild(optAll);
  allTopics.forEach(t => {
    const o = document.createElement("option");
    o.value = t;
    o.textContent = t;
    els.category.appendChild(o);
  });

  // Year options
  els.year.innerHTML = "";
  const yAll = document.createElement("option");
  yAll.value = "__all__";
  yAll.textContent = "All years";
  els.year.appendChild(yAll);
  allYears.forEach(y => {
    const o = document.createElement("option");
    o.value = String(y);
    o.textContent = String(y);
    els.year.appendChild(o);
  });

  // Topic quick links
  els.navTopics.innerHTML = "";
  allTopics.forEach(t => {
    const a = document.createElement("a");
    a.className = "pill";
    a.href = "#topic-" + slug(t);
    a.textContent = t;
    els.navTopics.appendChild(a);
  });
}

function slug(s){
  return (s || "")
    .toString()
    .trim()
    .toLowerCase()
    .replace(/&/g, "and")
    .replace(/[^a-z0-9]+/g, "-")
    .replace(/(^-|-$)/g, "");
}

function applySort(list, mode){
  const copy = [...list];
  if(mode === "year_desc") return copy.sort((a,b)=>(b.year||0)-(a.year||0) || (a.title||"").localeCompare(b.title||""));
  if(mode === "year_asc")  return copy.sort((a,b)=>(a.year||0)-(b.year||0) || (a.title||"").localeCompare(b.title||""));
  if(mode === "title_desc")return copy.sort((a,b)=>(b.title||"").localeCompare(a.title||""));
  return copy.sort((a,b)=>(a.title||"").localeCompare(b.title||""));
}

function matchPub(p, q, topic, year){
  const qn = norm(q).trim();
  const topicOk = (topic === "__all__") || (p.topics || []).includes(topic);
  const yearOk = (year === "__all__") || (String(p.year) === String(year));
  if(!topicOk || !yearOk) return false;
  if(!qn) return true;

  const hay = [
    p.title, p.authors, p.venue, p.type,
    (p.topics||[]).join(" "),
    (p.keywords||[]).join(" ")
  ].map(norm).join(" | ");
  return hay.includes(qn);
}

function render(){
  const q = els.q.value;
  const topic = els.category.value;
  const year = els.year.value;
  const sortMode = els.sort.value;

  const filtered = publications.filter(p => matchPub(p, q, topic, year));
  const sorted = applySort(filtered, sortMode);

  // Numbering is global across the filtered list
  els.countTag.textContent = `${sorted.length} item${sorted.length===1?"":"s"}`;

  // Group by topic (each paper may appear in multiple topics)
  const topicMap = new Map();
  for(const p of sorted){
    const topics = (p.topics && p.topics.length) ? p.topics : ["Uncategorized"];
    for(const t of topics){
      if(topic !== "__all__" && t !== topic) continue; // if a topic filter is selected
      if(!topicMap.has(t)) topicMap.set(t, []);
      topicMap.get(t).push(p);
    }
  }

  // Render sections
  els.root.innerHTML = "";
  const topicsOrdered = Array.from(topicMap.keys()).sort((a,b)=>a.localeCompare(b));

  // A running global index for numbering (P01, P02...)
  const indexByObject = new Map();
  sorted.forEach((p,i)=>indexByObject.set(p, i+1));

  topicsOrdered.forEach(t => {
    const sec = document.createElement("div");
    sec.className = "section";
    sec.id = "topic-" + slug(t);

    const header = document.createElement("div");
    header.className = "section-header";

    const h = document.createElement("h3");
    h.className = "section-title";
    h.textContent = t;

    const tag = document.createElement("span");
    tag.className = "tag";
    tag.textContent = `${topicMap.get(t).length} item${topicMap.get(t).length===1?"":"s"}`;

    header.appendChild(h);
    header.appendChild(tag);

    const body = document.createElement("div");
    body.className = "section-body";

    // Within each topic, sort papers by the selected mode too
    const papersHere = applySort(topicMap.get(t), sortMode);

    papersHere.forEach(p => {
      const n = indexByObject.get(p);
      const card = document.createElement("div");
      card.className = "paper";

      const top = document.createElement("div");
      top.className = "paper-top";

      const num = document.createElement("span");
      num.className = "num";
      num.textContent = `P${String(n).padStart(2,"0")}`;

      const title = document.createElement("p");
      title.className = "title";
      title.textContent = p.title || "(untitled)";

      top.appendChild(num);
      top.appendChild(title);

      const meta = document.createElement("div");
      meta.className = "meta";
      const yr = p.year ? `<b>${p.year}</b>` : "";
      const venue = p.venue ? ` — ${escapeHtml(p.venue)}` : "";
      const type = p.type ? ` <span class="muted">(${escapeHtml(p.type)})</span>` : "";
      meta.innerHTML = `${yr}${venue}${type}<br/><span class="muted">${escapeHtml(p.authors || "")}</span>`;

      const pills = document.createElement("div");
      pills.className = "pillrow";

      (p.links || []).forEach(L => {
        const a = document.createElement("a");
        a.className = "pill";
        a.href = L.href;
        a.target = L.href.startsWith("http") ? "_blank" : "_self";
        a.rel = L.href.startsWith("http") ? "noopener" : "";
        a.textContent = L.label || "Link";
        pills.appendChild(a);
      });

      if(p.keywords && p.keywords.length){
        const k = document.createElement("span");
        k.className = "pill";
        k.title = "Keywords";
        k.textContent = "Keywords: " + p.keywords.slice(0,6).join(", ") + (p.keywords.length>6 ? "…" : "");
        pills.appendChild(k);
      }

      // Copy citation
      const citeBtn = document.createElement("a");
      citeBtn.className = "pill";
      citeBtn.href = "#";
      citeBtn.textContent = "Copy citation";
      citeBtn.addEventListener("click", async (e) => {
        e.preventDefault();
        const cite = formatCitation(p);
        try{
          await navigator.clipboard.writeText(cite);
          citeBtn.textContent = "Copied!";
          setTimeout(()=>citeBtn.textContent="Copy citation", 800);
        }catch(err){
          alert("Clipboard copy failed. Citation:\n\n" + cite);
        }
      });
      pills.appendChild(citeBtn);

      card.appendChild(top);
      card.appendChild(meta);
      card.appendChild(pills);

      body.appendChild(card);
    });

    sec.appendChild(header);
    sec.appendChild(body);
    els.root.appendChild(sec);
  });

  if(sorted.length === 0){
    const empty = document.createElement("div");
    empty.className = "paper";
    empty.innerHTML = `<div class="paper-top"><span class="num">—</span><p class="title">No matches</p></div>
      <div class="meta">Try clearing filters or changing your search terms.</div>`;
    els.root.appendChild(empty);
  }
}

function escapeHtml(s){
  return (s||"")
    .toString()
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}

function formatCitation(p){
  // Simple APA-like stub (you can refine later)
  const authors = (p.authors || "").replaceAll(";", ",");
  const year = p.year ? `(${p.year}). ` : "";
  const title = p.title ? `${p.title}. ` : "";
  const venue = p.venue ? `${p.venue}.` : "";
  return `${authors}. ${year}${title}${venue}`.replace(/\s+/g," ").trim();
}

function resetFilters(){
  els.q.value = "";
  els.category.value = "__all__";
  els.year.value = "__all__";
  els.sort.value = "year_desc";
  render();
}

function templateEntry(){
  return `{
  year: 2026,
  title: "Your paper title here",
  authors: "First Author; Second Author; Arghavan Alisoltani; ...",
  venue: "Journal / Conference / Book",
  type: "Journal Article",
  topics: ["Viral Genomics & Structural Bioinformatics"],
  keywords: ["keyword1", "keyword2"],
  links: [
    { label: "PDF (local)", href: "papers/your_pdf_name.pdf" },
    { label: "DOI", href: "https://doi.org/..." }
  ]
}`;
}

async function copyNewTemplate(){
  try{
    await navigator.clipboard.writeText(templateEntry());
    els.copyTemplate.textContent = "Template copied!";
    setTimeout(()=>els.copyTemplate.textContent="Copy “new paper” template", 900);
  }catch(e){
    alert("Copy failed. Template:\n\n" + templateEntry());
  }
}

// wire up events
["input","change"].forEach(evt => {
  els.q.addEventListener(evt, render);
  els.category.addEventListener(evt, render);
  els.year.addEventListener(evt, render);
  els.sort.addEventListener(evt, render);
});
els.reset.addEventListener("click", resetFilters);
els.copyTemplate.addEventListener("click", copyNewTemplate);

// init
buildFilters();
resetFilters();
</script>
</body>
</html>
